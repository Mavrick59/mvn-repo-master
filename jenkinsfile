pipeline{ 
    agent any
    stages {
        stage('GIt checkout'){
            steps{
                script{
                    git 'https://github.com/Mavrick59/project-0.3.git'
                }
            }
        }
        stage('UNIT testing'){
              
            steps{
                sh 'mvn test'
            }
        }
        stage("Integration Testing"){

            steps{
                sh 'mvn verify -DskipUnitTests'
            }
        }
        stage('MVN building'){

            steps{
                sh 'mvn clean package'
            }
        }
        stage('static code analysis'){

            steps{

                script{

                 withSonarQubeEnv('sonar') {
                       sh 'mvn sonar:sonar' 
                
                    }
                }
               
               
            }
        }
        stage('upload war file to nexus'){

            steps{

                def readPomVersion = readMavenPom file 'pom.xml'

                def nexusRepo = readMavenPom.version.endsWith("2.5-SNAPSHOT") ? "SNAP" : "NEXUS REPO"

                script{

                 nexusArtifactUploader artifacts: [[artifactId: 'maven-war-plugin',
                 classifier: '', 
                 file: 'target/studentapp-2.5-SNAPSHOT.war', 
                 type: 'war']], 
                 credentialsId: 'sudent-app', 
                 groupId: 'com.jdevs', 
                 nexusUrl: '43.205.212.232:8081', 
                 nexusVersion: 'nexus3', 
                 protocol: 'http', 
                 repository:'http://43.205.212.232:8081/repository/studentapp/', 
                 version:"${env.BUILD_ID}"
                }
            }
        }
    }
}
    
